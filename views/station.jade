//Home Page

extends layout

block scripts
    link(href="/stylesheets/play.css", rel="stylesheet")

block d3
    script(type='text/javascript', src="http://d3js.org/d3.v3.min.js")
    script(src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js")
    script
        $(document).ready(function() {

            if(navigator.geolocation) {
              navigator.geolocation.getCurrentPosition(function(position) {
                $.post('/getLocation', {'latitude': position.coords.latitude, 'longitude': position.coords.longitude})
              })
            }

            var upvote = function() {
              console.log("Upvote");
              name = $('#songName').attr('name');
              artist = $('#songName').attr('artist');
              base_url = window.location.pathname;
              $('.downvote').attr('src', '/images/down.png')
              $('.upvote').attr('src', '/images/up_green.png')
              $.post(base_url + '/edit', {'name': name, 'artist': artist, 'up': true}, vote_response)
            }

            var downvote = function() {
              console.log("Downvote");
              name = $('#songName').attr('name');
              artist = $('#songName').attr('artist');
              base_url = window.location.pathname;
              $('.downvote').attr('src', '/images/down_red.png')
              $('.upvote').attr('src', '/images/up.png')
              $.post(base_url + '/edit', {'name': name, 'artist': artist, 'up': false}, vote_response)
            }

            $('.upvote').on('click', upvote);
            $('.downvote').on('click', downvote);

        });

block content

    div.meta-wrapper

        div.wrapper
            div.chart_body
            div.description
                | Listening to:
                | #{station}

        div.wrapper.pull-left
            if host == true
                include play_partial
            else
                include play_partial_user
            div.center-text#move-right
                include newsearch

        div.wrapper_right
            div.list_users

    script

        var user_list = !{friends};
        var user_id = '#{fb_id}'
        var users = user_list.users
        for (var i=0; i<users.length; i++) {
            if (users[i].fb_id != user_id) {
                if (users[i].fb_id) {
                    $('.list_users').append("<a href='/friend/" + users[i].fb_id + "'>" +
                        "<img src='https://graph.facebook.com/" +
                        users[i].fb_id + "/picture?width=300&height=300' class='fix-width station-fix-width'>" +
                        "<div style='margin-bottom:15px;'>" + users[i].name + "</div></a>")
                }
            }
        }

    div.name
    include d3_wheel
