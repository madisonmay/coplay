!!! 5
html
  head
    meta(name='viewport', content='initial-scale=1.0, user-scalable=no')

    link(href='http://fonts.googleapis.com/css?family=Unica+One', rel='stylesheet', type='text/css')
    style(type='text/css')
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #map-canvas {
        height: 100%;
        width: 100%
        //- margin-right: 300px;
      }

      #map-wrapper {
        width: 70%;
        height: 100%;
        display: inline-block;
        float: left;
      }

      #station-wrapper {
        float: right;
        width: 30%;
        height: 100%;
        padding: 0px;
        display: inline-block;
      }

      #station-info {
        height: 100%;
        margin: 0px;
        padding: 0px;
        border-radius: 0px;
      }

      #search-title {
        padding-top: 15px;
        text-align: center;
        font-size: 40px;
        font-family: Unica One;
      }

      #smaller {
        margin-right: 20px;
        margin-left: 20px;
      }

      #button-wrapper {
        text-align: center;
        margin-top: 10px;
      }

      #station-title{
        width: 50%;
      }

      #add-station {
        margin-left: 10px;
        margin-top: -10px;
      }



    // script(src="javascripts/geoplugin.gp", type="text/javascript")
    link(href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.0/css/bootstrap-combined.min.css", rel="stylesheet")
    script(src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.0/js/bootstrap.min.js")
    script(type='text/javascript', src='http://code.jquery.com/jquery.js')
    script(type='text/javascript', src='https://maps.googleapis.com/maps/api/js?key=AIzaSyCv3GjNM-TpvB0e5B5Uf_yTJFD4UyVRC7o&sensor=false')
    script(src="/javascripts/infobox.js")
    script(type='text/javascript')


      function distance(lat1, lon1, lat2, lon2) {
        //- Find the distance between two lat/lon points
        var R = 6371; // km
        var dLat = (lat2-lat1).toRad();
        var dLon = (lon2-lon1).toRad();
        var lat1 = lat1.toRad();
        var lat2 = lat2.toRad();

        var a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.sin(dLon/2) * Math.sin(dLon/2) * Math.cos(lat1) * Math.cos(lat2);
        var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        var d = R * c;
        return d;
      }

      var marker;

      function map_setup(map, pos) {
        map.setCenter(pos);
        marker = new google.maps.Marker({
          position: map.getCenter(),
          map: map,
          title: "",
          animation: google.maps.Animation.DROP
        });

        var labelText = "<div style='background-color: white; color: white; margin-top: -160px; margin-left: -35px;" +
                        "border-radius: 70px; height: 100px; width: 100px; font-size: 16px; border: 10px #A0A0A0 solid;'>" +
                        "<img src='/images/home.png' alt='Home' style='width: 60px; margin-top:18px;'></div>";

        var myOptions = {
           content: labelText,
           boxStyle: {
             textAlign: "center",
             fontSize: "16pt",
             width: "50px"
           },
           disableAutoPan: true,
           pixelOffset: new google.maps.Size(-25, 0),
           position: map.getCenter(),
           closeBoxURL: "",
           isHidden: false,
           pane: "mapPane",
           enableEventPropagation: true
        };

        var ib = new InfoBox(myOptions);

        google.maps.event.addListener(marker, 'mouseover', function() {
          ib.open(map, marker);
        });

        google.maps.event.addListener(marker, 'mouseout', function() {
          ib.close();
        });
      }

      var user_pos;

      function initialize() {

        var mapOptions = {
          zoom: 14,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        };

        var map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);

        if(navigator.geolocation) {
          console.log("HTML5 compatible")
          navigator.geolocation.getCurrentPosition(function(position) {
            var pos = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
            map_setup(map, pos);
          })
        } else {
          console.log("Not HTML5 compatible")
          var user_pos;
          var pos = new google.maps.LatLng(geoplugin_latitude(), geoplugin_longitude());
          map_setup(map, pos);
        }
      }

      $(document).ready(function() {
        initialize();
        $('#add-station').click(function() {
          console.log("Station added!");
          navigator.geolocation.getCurrentPosition(function(position) {
            $.post('/station', {'latitude': position.coords.latitude, 'longitude': position.coords.longitude,
                   'name': $('#station-title').val()}, station_created());
          });
        });
      });


      function station_created(err, data) {
        console.log('Called back')
        if (err) {
          console.log(err);
        } else {
          console.log(data)
          window.location = '/';
        }
      };

  body
    div#map-wrapper
      div#map-canvas
    div#station-wrapper
      div.hero-unit#station-info
        div#search-title
          | Local Stations
        hr#smaller
        div#button-wrapper
          input#station-title(type='text', placeholder='Station name...')
          button.btn.btn-success#add-station() Broadcast
